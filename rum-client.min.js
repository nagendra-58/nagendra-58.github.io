!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t||4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,(function(t){return e[t]}).bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function t(){return e.default}:function t(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/index.ts")}({"./src/index.ts":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){var t=this,n=e.trackUrl,r=e.threshold,o=void 0===r?6e3:r,i=e.batchSize,a=e.excludeKeys,s=e.excludeHosts,u=e.includeHosts,d=e.parserCb,c=e.filterCb,l=e.addAdditionalData;this.queuedEntries=[],this.options={trackUrl:n,threshold:o,batchSize:void 0===i?50:i,excludeKeys:void 0===a?[]:a,excludeHosts:void 0===s?[]:s,includeHosts:void 0===u?[]:u,parserCb:d,filterCb:c,addAdditionalData:l},"performance"in window&&"PerformanceObserver"in window&&new PerformanceObserver(function(e,n){t.handleEntries(e.getEntries())}).observe({entryTypes:["resource"]}),window.onload=function(){setTimeout(function(){console.log("onload------------>"),t.handleEntries(performance.getEntriesByType("navigation"))},0)},console.log("Setting up setInterval to push track data"),this.intervalId=window.setInterval(function(){t.queuedEntries.length&&(t.sendToServer(),t.queuedEntries=[])},o)}return e.computeMetrics=function(e){return e.dnsTime=e.domainLookupEnd-e.domainLookupStart,e.connectionTime=e.connectEnd-e.connectStart,e.secureConnectionStart>0&&(e.tlsTime=e.connectEnd-e.secureConnectionStart),e.ttfb=e.responseStart-e.requestStart,e.fetchTime=e.responseEnd-e.fetchStart,e.workerStart>0&&(e.workerTime=e.responseEnd-e.workerStart),e.totalTime=e.responseEnd-e.requestStart,e.downloadTime=e.responseEnd-e.responseStart,e.headerSize=e.transferSize-e.encodedBodySize,e.compressionRatio=e.decodedBodySize/e.encodedBodySize,"navigation"===e.entryType&&(e.DOMContentLoadTime=e.domContentLoadedEventEnd-e.startTime,e.pageLoadTime=e.loadEventEnd-e.startTime),e},e.chunk=function(e,t){return e.reduce(function(e,n,r){return r%t==0&&e.push([]),e[e.length-1].push(n),e},[])},e.prototype.handleEntries=function(t){console.log("handleEntries------------>");var n=this.options,r=(n.trackUrl,n.excludeKeys),o=(n.excludeHosts,n.includeHosts,n.parserCb),i=n.filterCb;t=t.map(function(e){return e.toJSON()}),console.log(" entries.map------------>",t),console.log("TrackPerformance----------->",e),t=t.map(e.computeMetrics),console.log("entries----------->",t),o&&"function"==typeof o&&(t=t.map(o)),i&&"function"==typeof i&&(t=t.filter(i)),r.length&&(t=t.map(function(e){return Object.keys(e).reduce(function(t,n){return -1===r.indexOf(n)&&(t[n]=e[n]),t},{})})),this.queuedEntries=this.queuedEntries.concat(t),console.log("queuedEntries---------->",this.queuedEntries)},e.prototype.sendToServer=function(){var t=this.options,n=t.batchSize,r=t.trackUrl,o=t.addAdditionalData,i=e.chunk(this.queuedEntries,void 0===n?50:n),a=Promise.resolve();i.forEach(function(e,t){a=a.then(function(){return new Promise(function(t,n){var i={data:e,additionalData:o()};fetch(r,{method:"post",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:JSON.stringify(i)}).then(function(e){return e.json()}).then(function(e){return t()}).catch(function(e){return console.log("Error while sending data to /track: ",e,i),t()})})})})},e.prototype.stop=function(){clearInterval(this.intervalId),this.intervalId=0},e}();window.TrackPerformance=r,t.default=r}});